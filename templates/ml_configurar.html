{% extends "base.html" %}

{% block title %}Configurar Mercado Livre - MetriFy ERP{% endblock %}

{% block content %}
<div class="content-inner">
  <div class="topbar">
    <div class="topbar-title">
      <i class="bi bi-gear"></i>
      Configurar Integração Mercado Livre
      <span class="badge bg-primary">API Automática</span>
    </div>
  </div>

  <div class="card-glass">
    <div class="card-glass-header">
      <div class="card-glass-title">
        <i class="bi bi-1-circle-fill"></i>
        Passo 1: Criar Aplicação no Mercado Livre
      </div>
    </div>

    <div class="alert alert-info">
      <h5 class="alert-heading">
        <i class="bi bi-info-circle"></i>
        Como obter as credenciais:
      </h5>
      <ol class="mb-0">
        <li>Acesse: <a href="https://developers.mercadolivre.com.br/apps" target="_blank" class="alert-link">https://developers.mercadolivre.com.br/apps</a></li>
        <li>Clique em "Criar nova aplicação"</li>
        <li>Preencha os dados e em <strong>Redirect URI</strong> coloque: <code>{{ url_for('ml_callback', _external=True) }}</code></li>
        <li>Copie o <strong>App ID</strong> (Client ID) e <strong>Secret Key</strong> (Client Secret)</li>
      </ol>
    </div>
  </div>

  <div class="card-glass">
    <div class="card-glass-header">
      <div class="card-glass-title">
        <i class="bi bi-2-circle-fill"></i>
        Passo 2: Inserir Credenciais
      </div>
    </div>

    <form method="POST">
      <div class="mb-3">
        <label for="client_id" class="form-label fw-bold">
          <i class="bi bi-key"></i>
          Client ID (App ID)
        </label>
        <input 
          type="text" 
          class="form-control" 
          id="client_id" 
          name="client_id" 
          value="{{ config.client_id if config else '' }}"
          placeholder="1234567890123456"
          required
        >
      </div>

      <div class="mb-4">
        <label for="client_secret" class="form-label fw-bold">
          <i class="bi bi-shield-lock"></i>
          Client Secret (Secret Key)
        </label>
        <input 
          type="password" 
          class="form-control" 
          id="client_secret" 
          name="client_secret" 
          value="{{ config.client_secret if config else '' }}"
          placeholder="AbCdEfGhIjKlMnOpQrStUvWx"
          required
        >
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-save"></i>
          Salvar Credenciais
        </button>
        {% if config and config.client_id %}
        <a href="{{ url_for('ml_conectar') }}" class="btn btn-success">
          <i class="bi bi-link-45deg"></i>
          Conectar Conta ML
        </a>
        {% endif %}
      </div>
    </form>
  </div>

  {% if config and config.access_token %}
  <div class="card-glass">
    <div class="card-glass-header">
      <div class="card-glass-title text-success">
        <i class="bi bi-check-circle-fill"></i>
        Status da Conexão
      </div>
    </div>

    <div class="alert alert-success mb-0">
      <h5 class="alert-heading">
        <i class="bi bi-wifi"></i>
        ✅ Conectado ao Mercado Livre
      </h5>
      <p class="mb-2"><strong>User ID:</strong> {{ config.user_id }}</p>
      <p class="mb-0"><strong>Token expira em:</strong> {{ config.token_expira[:19] if config.token_expira else 'N/A' }}</p>
      <hr>
      <a href="{{ url_for('ml_sincronizar_view') }}" class="btn btn-success">
        <i class="bi bi-arrow-repeat"></i>
        Ir para Sincronização
      </a>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
